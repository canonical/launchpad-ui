# Source commit: dfa26287935c94eca49aa76beb14a9f5059ff8bb (job-manager:main)
openapi: 3.1.0
info:
  title: Job Manager API
  description: A modern job management system
  version: 2.0.0
paths:
  /v1/jobs:
    post:
      tags:
      - jobs
      summary: Create Job
      description: |-
        Create a new job in the system.

        Args:
            job_in: Job creation model containing all required job parameters
            db: Database session dependency
            token: API access token for authorization

        Returns:
            dict: Contains the status_url for the created job

        Raises:
            HTTPException 400: If invalid tag format is provided
            HTTPException 401: If authorization token is invalid or missing
      operationId: create_job_v1_jobs_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobCreate'
      responses:
        '201':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - jobs
      summary: Get Jobs
      description: |-
        Retrieve a list of all jobs in the system.

        Args:
            tags: Optional list of tags to filter jobs by (AND logic)
            architecture: Optional architecture to filter jobs by
            requested_by: Optional user identity to filter jobs by
            base_series: Optional base series to filter jobs by
            status: Optional job status to filter jobs by
            private: Optional flag to filter by privacy status
            repository_url: Optional repository URL to filter jobs by
            sort: Optional field to sort by (prefix with - for descending)
            limit: Optional number of records to return
            offset: Optional number of records to skip
            db: Database session dependency
            token: API access token for authorization

        Returns:
            JobsListResponse: Paginated response with metadata and jobs data

        Raises:
            HTTPException 401: If authorization token is invalid or missing
            HTTPException 400: If sort field is invalid
      operationId: get_jobs_v1_jobs_get
      parameters:
      - name: tags
        in: query
        required: false
        schema:
          anyOf:
          - type: array
            items:
              type: string
          - type: 'null'
          description: Filter jobs by tags (comma-separated)
          title: Tags
        description: Filter jobs by tags (comma-separated)
      - name: architecture
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Architecture
      - name: requested_by
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Requested By
      - name: base_series
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Base Series
      - name: status
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Status
      - name: private
        in: query
        required: false
        schema:
          anyOf:
          - type: boolean
          - type: 'null'
          title: Private
      - name: repository_url
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Repository Url
      - name: sort
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Sort by field (prefix with - for descending, e.g., -created_at)
          title: Sort
        description: Sort by field (prefix with - for descending, e.g., -created_at)
      - name: limit
        in: query
        required: false
        schema:
          anyOf:
          - type: integer
            minimum: 0
          - type: 'null'
          description: Number of records to return
          title: Limit
        description: Number of records to return
      - name: offset
        in: query
        required: false
        schema:
          anyOf:
          - type: integer
            minimum: 0
          - type: 'null'
          description: Number of records to skip
          title: Offset
        description: Number of records to skip
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobsListResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/jobs/{job_id}:
    get:
      tags:
      - jobs
      summary: Get Job
      description: |-
        Retrieve a specific job by its ID.

        Args:
            job_id: Unique identifier of the job
            db: Database session dependency
            token: Optional API access token for authorization (required for
            private jobs)

        Returns:
            JobRead: The requested job object

        Raises:
            HTTPException 404: If job is not found
            HTTPException 401: If job is private and no valid token is provided
            HTTPException 403: If user doesn't have permission to view private job
      operationId: get_job_v1_jobs__job_id__get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: integer
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRead'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    put:
      tags:
      - jobs
      summary: Update Job
      description: |-
        Update an existing job's priority.

        Only admin users can update job priority.

        Args:
            job_id: Unique identifier of the job to update
            job_in: Job priority update model containing priority field
            db: Database session dependency
            token: API access token for authorization (must have admin role)

        Returns:
            JobRead: The updated job object

        Raises:
            HTTPException 400: If job status is not PENDING
            HTTPException 401: If authorization token is invalid or missing
            HTTPException 403: If user does not have admin role
            HTTPException 404: If job is not found
      operationId: update_job_v1_jobs__job_id__put
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: integer
          title: Job Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobPriorityUpdate'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRead'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/jobs/{job_id}/health:
    put:
      tags:
      - jobs
      summary: Update Health
      description: |-
        Update the health status of a running job.

        This endpoint accepts health data and immediately returns 200 OK.
        All processing is done asynchronously in a background task.

        Args:
            job_id: Unique identifier of the job
            request: FastAPI request object containing health data
            background_tasks: FastAPI background tasks for async operations
            db: Database session dependency
            token: Builder token for authorization

        Returns:
            dict: Acknowledgment of health update receipt

        Raises:
            HTTPException 401: If builder token is invalid or missing
            HTTPException 404: If job is not found
      operationId: update_health_v1_jobs__job_id__health_put
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: integer
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - jobs
      summary: Get Health
      description: |-
        Retrieve the current health status of a job.

        Args:
            job_id: Unique identifier of the job
            db: Database session dependency

        Returns:
            dict: Health status information including CPU, RAM, disk usage, and job
                status

        Raises:
            HTTPException 401: If authorization token is invalid or missing
            HTTPException 404: If job is not found or not active/executing
      operationId: get_health_v1_jobs__job_id__health_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: integer
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/jobs/{job_id}/cancel:
    put:
      tags:
      - jobs
      summary: Cancel Job
      description: |-
        Cancel a running job.

        Args:
            job_id: Unique identifier of the job to cancel
            db: Database session dependency
            token: API access token for authorization

        Returns:
            dict: Confirmation message of job cancellation

        Raises:
            HTTPException 400: If job cannot be cancelled or is already in final
                state
            HTTPException 401: If job is private and no valid token is provided
            HTTPException 403: If user doesn't have permission to cancel private
                job
            HTTPException 404: If job is not found
      operationId: cancel_job_v1_jobs__job_id__cancel_put
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: integer
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/jobs/{job_id}/object/{object_name}:
    get:
      tags:
      - jobs
      summary: Download Object
      description: |-
        Download an artifact, log, or metadata file associated with a job.

        Args:
            job_id: Unique identifier of the job
            object_name: Path to the object, with format: {type}/{filename}
                         where type is 'artifact', 'log', or 'metadata'
                         (URL-encoded). Also supports legacy format without type.
            inline: If True, display inline in browser
                    (Content-Disposition: inline) and force text/plain for
                    files listed in the job's log_urls. Defaults to False.
            omit_content_length: If True, do not include Content-Length header.
            db: Database session dependency

        Returns:
            StreamingResponse: Stream of the requested object data with appropriate
                headers

        Raises:
            HTTPException 401: If job is private and no valid token is provided
            HTTPException 403: If user doesn't have permission to view private job
                               or access validation fails
            HTTPException 404: If job or object is not found
            HTTPException 500: If object cannot be accessed or S3 error occurs
      operationId: download_object_v1_jobs__job_id__object__object_name__get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: integer
          title: Job Id
      - name: object_name
        in: path
        required: true
        schema:
          type: string
          title: Object Name
      - name: inline
        in: query
        required: false
        schema:
          type: boolean
          description: Display inline in browser
          default: false
          title: Inline
        description: Display inline in browser
      - name: omit_content_length
        in: query
        required: false
        schema:
          type: boolean
          description: Omit Content-Length header from the response
          default: false
          title: Omit Content Length
        description: Omit Content-Length header from the response
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    head:
      tags:
      - jobs
      summary: Get Object Metadata
      description: |-
        Get metadata (headers only) for an artifact or object associated with a
        job.

        Args:
            job_id: Unique identifier of the job
            object_name: Name of the object/artifact to get metadata for
                (URL-encoded)
            db: Database session dependency
            token: Optional API access token for authorization (required for
                private jobs)

        Returns:
            JSONResponse: Empty response with Content-Type and Content-Length
                headers

        Raises:
            HTTPException 404: If job or object is not found
            HTTPException 401: If job is private and no valid token is provided
            HTTPException 403: If user doesn't have permission to view private job
                               or access validation fails
            HTTPException 500: If object cannot be accessed
      operationId: get_object_metadata_v1_jobs__job_id__object__object_name__head
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: integer
          title: Job Id
      - name: object_name
        in: path
        required: true
        schema:
          type: string
          title: Object Name
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/jobs/{job_id}/artifacts/download:
    get:
      tags:
      - jobs
      summary: Download All Artifacts
      description: |-
        Download all artifacts for a job as a single zip file.

        Args:
            job_id: Unique identifier of the job
            db: Database session dependency
            token: Optional API access token for authorization (required for
                private jobs)

        Returns:
            StreamingResponse: Stream of a zip file containing all job artifacts

        Raises:
            HTTPException 401: If job is private and no valid token is provided
            HTTPException 403: If user doesn't have permission to view private job
            HTTPException 404: If job is not found or has no artifacts
            HTTPException 500: If artifacts cannot be accessed or S3 error occurs
      operationId: download_all_artifacts_v1_jobs__job_id__artifacts_download_get
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: integer
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/jobs/{job_id}/token:
    post:
      tags:
      - jobs
      summary: Generate Token
      description: |-
        Generate a JWT token for job authentication and set up SSH keys.

        SSH keys are now stored in the database with encryption for the private
        key, enabling multi-instance deployments without shared filesystem
        requirements.

        Args:
            job_id: Unique identifier of the job
            request: FastAPI request object potentially containing SSH keys
            db: Database session dependency
            token: API access token for authorization

        Returns:
            dict: Contains the generated JWT token

        Raises:
            HTTPException 401: If authorization token is invalid or missing
            HTTPException 404: If job is not found
            HTTPException 500: If SSH key generation fails
      operationId: generate_token_v1_jobs__job_id__token_post
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: integer
          title: Job Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/api_access_token:
    post:
      tags:
      - tokens
      summary: Create Api Access Token
      description: |-
        Create a new API access token for service authentication.

        Args:
            request: FastAPI request object with identity and optional expiration
            db: Database session dependency
            _: Internal-only access check dependency

        Returns:
            JSONResponse: Contains the generated token and identity

        Raises:
            HTTPException 400: If identity is missing from request
            HTTPException 403: If request is not from internal network or token is
                invalid
      operationId: create_api_access_token_v1_api_access_token_post
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
    delete:
      tags:
      - tokens
      summary: Revoke Api Access Token
      description: |-
        Revoke an existing API access token.

        Args:
            identity: Service identity associated with the token
            token: The token value to revoke
            db: Database session dependency
            _: Internal-only access check dependency

        Returns:
            dict: Contains the revoked token and identity

        Raises:
            HTTPException 403: If request is not from internal network or token is
                invalid
            HTTPException 404: If token is not found
      operationId: revoke_api_access_token_v1_api_access_token_delete
      parameters:
      - name: identity
        in: query
        required: true
        schema:
          type: string
          title: Identity
      - name: token
        in: query
        required: true
        schema:
          type: string
          title: Token
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/runners/register:
    post:
      tags:
      - runners
      summary: Register Runner
      description: |-
        Register a new runner.

        Args:
            runner_in: Runner registration data including name and labels
            db: Database session dependency

        Returns:
            dict: Contains the runner ID and its authentication token

        Raises:
            HTTPException 500: If token generation fails
      operationId: register_runner_v1_runners_register_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunnerCreate'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunnerRegisterResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/runners/{runner_id}/health:
    get:
      tags:
      - runners
      summary: Get Runner Health
      description: |-
        Get runner health status.

        Args:
            runner_id: Unique identifier of the runner
            db: Database session dependency

        Returns:
            dict: Runner health metrics including CPU, RAM, disk usage and status

        Raises:
            HTTPException 404: If runner is not found
      operationId: get_runner_health_v1_runners__runner_id__health_get
      parameters:
      - name: runner_id
        in: path
        required: true
        schema:
          type: integer
          title: Runner Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunnerHealthResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    put:
      tags:
      - runners
      summary: Update Runner Health
      description: |-
        Update runner health metrics.

        This endpoint accepts health data and immediately returns 200 OK.
        All processing is done asynchronously in a background task.

        Args:
            runner_id: Unique identifier of the runner
            request: FastAPI request object containing health metrics
            health_data: Health data sent by the runner
            background_tasks: FastAPI background tasks for async operations
            _: Runner token for authorization

        Returns:
            dict: Acknowledgment of health update receipt
      operationId: update_runner_health_v1_runners__runner_id__health_put
      parameters:
      - name: runner_id
        in: path
        required: true
        schema:
          type: integer
          title: Runner Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunnerHealthUpdate'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunnerHealthUpdateResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/runners/list:
    get:
      tags:
      - runners
      summary: List Runners
      description: |-
        List all runners that exist in OpenStack (admins only).

        Returns:
            list: List of runners that exist in OpenStack
      operationId: list_runners_v1_runners_list_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/RunnerListItem'
                type: array
                title: Response List Runners V1 Runners List Get
  /v1/runners/{runner_id}/rebuild:
    post:
      tags:
      - runners
      summary: Rebuild Runner Admin Only
      description: |-
        Force rebuild a runner (admins only).

        This endpoint forcefully rebuilds a runner regardless of its status.
        If the runner has an assigned job, that job will be marked as FAILED
        before the rebuild proceeds.

        Access control:
            - Requires a valid API access token
            - Token must have the `admin` role
      operationId: rebuild_runner_admin_only_v1_runners__runner_id__rebuild_post
      parameters:
      - name: runner_id
        in: path
        required: true
        schema:
          type: integer
          title: Runner Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /metrics:
    get:
      summary: Metrics
      description: Endpoint that serves Prometheus metrics.
      operationId: metrics_metrics_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
  /:
    get:
      summary: Root
      description: |-
        Root endpoint providing basic API information.

        Supports both GET and HEAD requests. HEAD requests are commonly
        used by monitoring tools and curl -I to check service status.

        Returns:
            dict: Basic API information including:
                - message: API identification
                - version: Current API version
                - status: Running status
      operationId: root__get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
    head:
      summary: Root
      description: |-
        Root endpoint providing basic API information.

        Supports both GET and HEAD requests. HEAD requests are commonly
        used by monitoring tools and curl -I to check service status.

        Returns:
            dict: Basic API information including:
                - message: API identification
                - version: Current API version
                - status: Running status
      operationId: root__head
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
  /health:
    get:
      summary: Health Check
      description: |-
        Health check endpoint for monitoring service status.

        This endpoint can be used by monitoring tools and load balancers to
        verify the service is operational.

        Returns:
            dict: Contains status indicating service health
      operationId: health_check_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
components:
  schemas:
    Architecture:
      type: string
      enum:
      - amd64
      - arm64
      - armel
      - armhf
      - ppc64el
      - s390x
      - riscv64
      - amd64v3
      - i386
      title: Architecture
      description: Supported CPU architectures.
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError
    JobCreate:
      properties:
        title:
          type: string
          title: Title
          default: ''
          examples:
          - Build Ubuntu 24.04 image
        description:
          type: string
          title: Description
          default: ''
          examples:
          - Build a hardened Ubuntu image with security patches
        repository_url:
          type: string
          title: Repository Url
          default: ''
          examples:
          - https://example.com/org/secure-images
        repository_ref:
          type: string
          title: Repository Ref
          default: ''
          examples:
          - main
        architecture:
          $ref: '#/components/schemas/Architecture'
          default: amd64
          examples:
          - amd64
        base_series:
          $ref: '#/components/schemas/Series'
          default: noble
          examples:
          - noble
        commands:
          items: {}
          type: array
          title: Commands
          default: []
          examples:
          - - sudo apt-get update
            - sudo apt-get install -y curl jq
            - make build
            - ./scripts/build.sh --release
        proxy_settings:
          additionalProperties: true
          type: object
          title: Proxy Settings
          default: {}
          examples:
          - policy: permissive
        secrets:
          additionalProperties: true
          type: object
          title: Secrets
          default: {}
          examples:
          - SECRET_TOKEN: s3cr3t_v4lu3
        environment:
          additionalProperties: true
          type: object
          title: Environment
          default: {}
          examples:
          - BUILD_MODE: hardened
        artifact_path:
          type: string
          title: Artifact Path
          default: ''
          examples:
          - build/artifacts/*.tar.gz
        topology:
          type: string
          title: Topology
          default: ''
          examples:
          - single-node
        vm_size:
          type: string
          title: Vm Size
          default: ''
          examples:
          - large
        private:
          type: boolean
          title: Private
          default: false
          examples:
          - true
        status:
          $ref: '#/components/schemas/JobStatus'
          default: PENDING
          examples:
          - FINISHED
        priority:
          type: integer
          title: Priority
          default: 0
          examples:
          - 4
        tags:
          items:
            type: string
          type: array
          title: Tags
          default: []
          examples:
          - - security
            - production
      type: object
      title: JobCreate
      description: Job creation model.
    JobObjectRead:
      properties:
        id:
          type: integer
          title: Id
          examples:
          - 1
        job_id:
          type: integer
          title: Job Id
          examples:
          - 123
        filename:
          type: string
          title: Filename
          examples:
          - output.tar.gz
        object_type:
          $ref: '#/components/schemas/ObjectType'
          examples:
          - artifact
        content_type:
          type: string
          title: Content Type
          examples:
          - application/gzip
        size_bytes:
          anyOf:
          - type: integer
          - type: 'null'
          title: Size Bytes
          examples:
          - 1024
        created_at:
          type: string
          format: date-time
          title: Created At
          examples:
          - '2024-01-15T10:30:00Z'
        url:
          type: string
          title: Url
          description: URL endpoint for this object
          readOnly: true
          examples:
          - https://example.com/jobs/123/object/artifact/output.tar.gz
      type: object
      required:
      - id
      - job_id
      - filename
      - object_type
      - content_type
      - created_at
      - url
      title: JobObjectRead
      description: Job object read model for artifacts and logs.
    JobPriorityUpdate:
      properties:
        priority:
          type: integer
          maximum: 10.0
          minimum: 0.0
          title: Priority
          examples:
          - 7
      type: object
      required:
      - priority
      title: JobPriorityUpdate
      description: |-
        Job priority update model.

        Only priority can be updated via this model, and only by admin users.
        This is used for the admin-only job update endpoint.
    JobRead:
      properties:
        title:
          type: string
          title: Title
          default: ''
          examples:
          - Build Ubuntu 24.04 image
        description:
          type: string
          title: Description
          default: ''
          examples:
          - Build a hardened Ubuntu image with security patches
        repository_url:
          type: string
          title: Repository Url
          default: ''
          examples:
          - https://example.com/org/secure-images
        repository_ref:
          type: string
          title: Repository Ref
          default: ''
          examples:
          - main
        architecture:
          $ref: '#/components/schemas/Architecture'
          default: amd64
          examples:
          - amd64
        base_series:
          $ref: '#/components/schemas/Series'
          default: noble
          examples:
          - noble
        commands:
          items: {}
          type: array
          title: Commands
          default: []
          examples:
          - - sudo apt-get update
            - sudo apt-get install -y curl jq
            - make build
            - ./scripts/build.sh --release
        proxy_settings:
          additionalProperties: true
          type: object
          title: Proxy Settings
          default: {}
          examples:
          - policy: permissive
        secrets:
          additionalProperties: true
          type: object
          title: Secrets
          default: {}
          examples:
          - SECRET_TOKEN: s3cr3t_v4lu3
        environment:
          additionalProperties: true
          type: object
          title: Environment
          default: {}
          examples:
          - BUILD_MODE: hardened
        artifact_path:
          type: string
          title: Artifact Path
          default: ''
          examples:
          - build/artifacts/*.tar.gz
        topology:
          type: string
          title: Topology
          default: ''
          examples:
          - single-node
        vm_size:
          type: string
          title: Vm Size
          default: ''
          examples:
          - large
        private:
          type: boolean
          title: Private
          default: false
          examples:
          - true
        status:
          $ref: '#/components/schemas/JobStatus'
          default: PENDING
          examples:
          - FINISHED
        priority:
          type: integer
          title: Priority
          default: 0
          examples:
          - 4
        tags:
          items:
            type: string
          type: array
          title: Tags
          default: []
          examples:
          - - security
            - production
        id:
          type: integer
          title: Id
          examples:
          - 123
        requested_by:
          type: string
          title: Requested By
          examples:
          - user
        created_at:
          type: string
          format: date-time
          title: Created At
          examples:
          - '2025-01-15T09:15:30.123456Z'
        updated_at:
          type: string
          format: date-time
          title: Updated At
          examples:
          - '2025-01-15T10:45:23.456789Z'
        started_at:
          anyOf:
          - type: string
            format: date-time
          - type: 'null'
          title: Started At
          examples:
          - '2025-01-15T09:20:11.987654Z'
        completed_at:
          anyOf:
          - type: string
            format: date-time
          - type: 'null'
          title: Completed At
          examples:
          - '2025-01-15T10:45:23.456789Z'
        objects:
          items:
            $ref: '#/components/schemas/JobObjectRead'
          type: array
          title: Objects
          examples:
          - - content_type: application/gzip
              created_at: '2025-01-15T10:30:00.123456Z'
              filename: build-output.tar.gz
              id: 1
              job_id: 123
              object_type: artifact
              size_bytes: 2048576
            - content_type: application/json
              created_at: '2025-01-15T10:30:05.123456Z'
              filename: fetch_service_metadata.json
              id: 2
              job_id: 123
              object_type: metadata
              size_bytes: 512
            - content_type: application/xml
              created_at: '2025-01-15T10:30:10.123456Z'
              filename: test-results.xml
              id: 3
              job_id: 123
              object_type: artifact
              size_bytes: 15360
            - content_type: text/html
              created_at: '2025-01-15T10:30:15.123456Z'
              filename: coverage-report.html
              id: 4
              job_id: 123
              object_type: artifact
              size_bytes: 51200
            - content_type: text/plain
              created_at: '2025-01-15T10:24:00.123456Z'
              filename: job_agent.log
              id: 5
              job_id: 123
              object_type: log
              size_bytes: 3840
            - content_type: text/plain
              created_at: '2025-01-15T10:25:00.123456Z'
              filename: default.log
              id: 6
              job_id: 123
              object_type: log
              size_bytes: 10240
        duration:
          anyOf:
          - type: number
          - type: 'null'
          title: Duration
          description: Duration of the job in seconds. For finished jobs, this is completed_at - started_at. For in-progress jobs, this is current time - started_at. Returns None if job hasn't started.
          readOnly: true
          examples:
          - 3600.5
        artifact_urls:
          items:
            type: string
          type: array
          title: Artifact Urls
          description: List of artifact URLs. Generated from objects table. Use objects field for full metadata.
          readOnly: true
          examples:
          - - https://example.com/jobs/123/object/artifact/output.tar.gz
            - https://example.com/jobs/123/object/metadata/fetch_service_metadata.json
        log_urls:
          items:
            type: string
          type: array
          title: Log Urls
          description: List of log URLs. Generated from objects table. Use objects field for full metadata.
          readOnly: true
          examples:
          - - https://example.com/jobs/123/object/default.log
      additionalProperties: true
      type: object
      required:
      - id
      - requested_by
      - created_at
      - updated_at
      - duration
      - artifact_urls
      - log_urls
      title: JobRead
      description: Job read model with all fields.
    JobStatus:
      type: string
      enum:
      - PENDING
      - EXECUTING
      - IDLE
      - FINISHED
      - FAILED
      - CANCELLED
      - TERMINATED
      title: JobStatus
      description: Job status values.
    JobsListMetadata:
      properties:
        total_count:
          type: integer
          title: Total Count
          examples:
          - 85
        count:
          type: integer
          title: Count
          examples:
          - 20
        limit:
          type: integer
          title: Limit
          examples:
          - 20
        offset:
          type: integer
          title: Offset
          default: 0
          examples:
          - 0
      type: object
      required:
      - total_count
      - count
      - limit
      title: JobsListMetadata
      description: Metadata for paginated jobs list response.
    JobsListResponse:
      properties:
        metadata:
          $ref: '#/components/schemas/JobsListMetadata'
        data:
          items:
            $ref: '#/components/schemas/JobRead'
          type: array
          title: Data
      type: object
      required:
      - metadata
      - data
      title: JobsListResponse
      description: Paginated response for jobs list.
    ObjectType:
      type: string
      enum:
      - artifact
      - log
      - metadata
      title: ObjectType
      description: Type of object being stored in S3.
    RunnerCreate:
      properties:
        name:
          type: string
          title: Name
        labels:
          items:
            type: string
          type: array
          title: Labels
        cloud_name:
          type: string
          title: Cloud Name
          default: local
      type: object
      required:
      - name
      - labels
      title: RunnerCreate
      description: Runner creation model.
    RunnerHealthResponse:
      properties:
        label:
          type: string
          title: Label
        cpu_usage:
          type: string
          title: Cpu Usage
        ram_usage:
          type: string
          title: Ram Usage
        disk_usage:
          type: string
          title: Disk Usage
        status:
          type: string
          title: Status
        deletable:
          type: boolean
          title: Deletable
      type: object
      required:
      - label
      - cpu_usage
      - ram_usage
      - disk_usage
      - status
      - deletable
      title: RunnerHealthResponse
    RunnerHealthUpdate:
      properties:
        vm_ip:
          anyOf:
          - type: string
          - type: 'null'
          title: Vm Ip
        status:
          $ref: '#/components/schemas/JobStatus'
        label:
          type: string
          title: Label
      additionalProperties: true
      type: object
      required:
      - status
      - label
      title: RunnerHealthUpdate
      description: |-
        Health update data received from runner or job agent.

        Accepts any additional fields the runner provides, but requires
        at least vm_ip, status, and label.
      examples:
      - cpu_usage: '45.2'
        disk_usage: '15360'
        label: test-runner-1
        ram_usage: '2048'
        status: EXECUTING
        vm_ip: 192.168.1.100
    RunnerHealthUpdateResponse:
      properties:
        message:
          type: string
          title: Message
      type: object
      required:
      - message
      title: RunnerHealthUpdateResponse
    RunnerListItem:
      properties:
        id:
          type: integer
          title: Id
        cloud_name:
          type: string
          title: Cloud Name
        openstack_server_id:
          type: string
          title: Openstack Server Id
        status:
          $ref: '#/components/schemas/RunnerStatus'
        job_id:
          anyOf:
          - type: integer
          - type: 'null'
          title: Job Id
        job_status:
          anyOf:
          - $ref: '#/components/schemas/JobStatus'
          - type: 'null'
      type: object
      required:
      - id
      - cloud_name
      - openstack_server_id
      - status
      title: RunnerListItem
      description: Model for runner list item.
    RunnerRegisterResponse:
      properties:
        id:
          type: integer
          title: Id
        token:
          type: string
          title: Token
        proxy:
          anyOf:
          - additionalProperties: true
            type: object
          - type: 'null'
          title: Proxy
      type: object
      required:
      - id
      - token
      title: RunnerRegisterResponse
    RunnerStatus:
      type: string
      enum:
      - CREATING
      - IDLE
      - BUSY
      - REBUILDING
      - DELETING
      - ERROR
      title: RunnerStatus
      description: Runner status values.
    Series:
      type: string
      enum:
      - noble
      - mantic
      - jammy
      - focal
      - bionic
      title: Series
      description: Supported Ubuntu series.
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError
